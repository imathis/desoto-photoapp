#! /usr/bin/env ruby

$LOAD_PATH.unshift(File.expand_path("../lib", File.dirname(__FILE__)))

require 'optparse'
require 'desoto-photoapp'

options = {}

OptionParser.new do |opts|
  opts.on("-c", "--config PATH", String, "Path to config file") do |config|
    options['config'] = config
  end
end.parse!

if ARGV.first == 'setup'
  ARGV.shift
  if `brew list imagemagick` =~ /Error:/
    system "brew install imagemagick"
  end
else

  if ARGV.first == 'process'
    ARGV.shift
    options['source'] = ARGV.shift
    Photoapp::Session.new(options).process
  elsif ARGV.first == 'upload'
    Photoapp::Session.new(options).upload
  elsif ARGV.first == 'reprint'
    ARGV.shift
    Photoapp.print(ARGV.shift)
  end
end
